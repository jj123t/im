syntax = "proto3";

package im.protocol;

import "google/protobuf/timestamp.proto";

// 基础消息类型
message Message {
    // 消息类型
    enum Type {
        SINGLE_CHAT = 0;
        GROUP_CHAT = 1;
        FILE_TRANSFER = 2;
        ADD_FRIEND = 3;
        ADD_GROUP = 4;
        SEARCH_USER = 5;
        SEARCH_GROUP = 6;
        LOGIN_REQUEST = 7;
        HEARTBEAT = 8;
    }

    // 消息类型标识
    Type type = 1;

    // 时间戳
    google.protobuf.Timestamp timestamp = 2;

    // 根据消息类型，只能设置其中一个字段
    oneof content {
        SingleChat single_chat = 3;
        GroupChat group_chat = 4;
        FileTransfer file_transfer = 5;
        AddFriend add_friend = 6;
        AddGroup add_group = 7;
        SearchUser search_user = 8;
        SearchGroup search_group = 9;
        LoginRequest login_request = 10;
        // Heartbeat不需要额外内容，可以省略
    }
}

// 单聊消息内容
message SingleChat {
    int32 sender_id = 1;
    int32 receiver_id = 2;
    string content = 3;
}

// 群聊消息内容
message GroupChat {
    int32 sender_id = 1;
    int32 group_id = 2;
    string content = 3;
}

// 文件传输消息内容
message FileTransfer {
    int32 sender_id = 1;
    int32 receiver_id = 2;
    string file_name = 3;
    bytes file_hash = 4; // 文件哈希，用于验证文件完整性
    int64 file_size = 5; // 文件大小
    // ... 可以添加更多文件传输相关字段
}

// 添加好友消息内容
message AddFriend {
    int32 sender_id = 1;
    int32 receiver_id = 2;
    string message = 3; // 附加消息，例如请求理由
}
message AddGroup {
    int32 sender_id = 1;
    int32 group_id = 2;
    string message = 3; // 附加消息，例如请求理由
}
message SearchUser {
    int32 sender_id = 1;
    string message = 2;
}
message SearchGroup {
    int32 sender_id = 1;
    string message = 2; // 附加消息，例如请求理由
}
// 登陆请求消息内容
message LoginRequest {
    int32 user_id = 1;
    string password = 2;
    // ... 可以添加其他验证字段，如设备信息等
}

// 心跳包不需要额外内容，因此在Message的oneof中已经省略